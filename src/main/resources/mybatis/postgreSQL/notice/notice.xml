<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.domain.notice.dao.NoticeDAO">
	
	<!-- 공지사항 목록 조회 -->
	<select id="getNoticeList" parameterType="egovframework.com.domain.notice.parameter.NoticeSearchParameter"
			resultType="egovframework.com.domain.notice.domain.Notice">
		SELECT 
			   COUNT(NOTICE_ID) OVER() AS TOTAL_COUNT
			 , COMPANY_ID
			 , NOTICE_ID
			 , TITLE
			 , ATTACH_ID as attachId
			 , get_user_nm(insert_id) AS INSERT_NAME
			 , TO_CHAR(INSERT_DATE, 'YY-MM-DD') AS INSERT_DATE
			 , VIEW_CNT
			 , IMPORT_010_CD AS improtCd
		  FROM RFT_NOTICE RN 
		 WHERE COMPANY_ID = #{companyId}
		   AND IS_DELETE = 0
		<!--  <if test="col != null">
		 </if> -->	
	</select>
	
	<!-- 공지사항 등록 -->
	<insert id="insertNotice" parameterType="egovframework.com.domain.notice.parameter.NoticeParameter">
		INSERT INTO RFT_NOTICE
		(COMPANY_ID, TITLE, IMPORT_010_CD, "content", ATTACH_ID, VIEW_CNT, IS_ENABLE, IS_DELETE, INSERT_ID, INSERT_DATE)
		VALUES(#{companyId}, #{title}, #{improtCd}, #{content}, #{attachId}, 0, 1, 0, #{userId}, now() )
	</insert>
	
	<!-- 공지사항 상세보기 -->
	<select id="getNotice" parameterType="HashMap" resultType="egovframework.com.domain.notice.domain.Notice">
		SELECT 
			   COMPANY_ID
			 , NOTICE_ID
			 , TITLE
			 , GET_USER_NM(INSERT_ID) AS INSERT_NAME
			 , TO_CHAR(INSERT_DATE, 'YY-MM-DD') AS INSERT_DATE
			 , VIEW_CNT
			 , "content"
			 , ATTACH_ID
		  FROM RFT_NOTICE 
		 WHERE COMPANY_ID = #{companyId}
		   AND NOTICE_ID = #{noticeId}
		   AND IS_DELETE = 0
	</select>
	
	<!-- 공지사항 조회수 증가 -->
	<update id="updateViewCount" parameterType="egovframework.com.domain.notice.domain.Notice">
		UPDATE RFT_NOTICE 
		   SET VIEW_CNT = VIEW_CNT + 1
		 WHERE COMPANY_ID = #{companyId}
		   AND NOTICE_ID = #{noticeId}
		<selectKey keyProperty="viewCnt" resultType="int" order="AFTER">
			SELECT VIEW_CNT AS viewCnt FROM RFT_NOTICE
			 WHERE COMPANY_ID = #{companyId}
		   	   AND NOTICE_ID = #{noticeId}
		</selectKey>		 
	</update>
	
	<!-- 공지사항 수정 -->
	<update id="updateNotice" parameterType="egovframework.com.domain.notice.parameter.NoticeParameter">
		UPDATE RFT_NOTICE
		   SET TITLE = #{title}, IMPORT_010_CD = #{improtCd}, "content" = #{content} , ATTACH_ID = #{attachId}, UPDATE_ID = #{userId}, UPDATE_DATE = now()
  	     WHERE COMPANY_ID = #{companyId}
    	   AND NOTICE_ID = #{noticeId}
    	   AND IS_DELETE = 0
	</update>
	
	<!--  공지사항 삭제 -->
	<update id="deleteNotice" parameterType="HashMap">
		UPDATE RFT_NOTICE
		   SET IS_DELETE = 1
		 WHERE COMPANY_ID = #{companyId}
		   AND NOTICE_ID = #{noticeId}
	</update>
	 
</mapper>