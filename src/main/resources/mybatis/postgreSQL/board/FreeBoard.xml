<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.domain.board.dao.FreeBoardDAO">
	<select id="getListCount" parameterType="egovframework.com.domain.board.parameter.FreeBoardSearchParameter" resultType="Long">
		SELECT 
			COUNT(*) AS TOTAL_COUNT
		FROM FREE_BOARD B
		<where>
			<!-- 키워드 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData)">
				<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData.keyword)">
					AND (B.TITLE LIKE CONCAT('%', #{searchData.keyword}, '%') OR B.CONTENTS LIKE CONCAT('%', #{searchData.keyword}, '%'))
				</if>
			</if>
			<!-- 게시판 종류 배열 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(boardTypes)">
			AND B.BOARD_TYPE IN (
				<foreach collection="boardTypes" item="value" separator=",">
				#{value}
				</foreach>
			)
			</if>
		</where>
	</select>
	
	<select id="getList" parameterType="egovframework.com.domain.board.parameter.FreeBoardSearchParameter" resultType="egovframework.com.domain.board.domain.FreeBoard">
		SELECT 
			B.BOARD_SEQ,
			B.BOARD_TYPE,
			B.TITLE,
			B.REG_DATE,
			TO_CHAR(B.REG_DATE,'YYYY-MM-DD') AS REG_DATE_YMD
		FROM FREE_BOARD B
		<where>
			<!-- 키워드 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData)">
				<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData.keyword)">
					AND (B.TITLE LIKE CONCAT('%', #{searchData.keyword}, '%') OR B.CONTENTS LIKE CONCAT('%', #{searchData.keyword}, '%'))
				</if>
			</if>
			<!-- 게시판 종류 배열 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(boardTypes)">
			AND B.BOARD_TYPE IN (
				<foreach collection="boardTypes" item="value" separator=",">
				#{value}
				</foreach>
			)
			</if>
			
		</where>
		ORDER BY B.REG_DATE DESC
	</select>
	
	<select id="getListExcel" parameterType="egovframework.com.domain.board.parameter.FreeBoardSearchParameter" resultType="egovframework.com.domain.board.domain.FreeBoard">
		SELECT 
			B.BOARD_SEQ,
			CASE
			     WHEN B.BOARD_TYPE='NOTICE' THEN '공지사항'
			     WHEN B.BOARD_TYPE='FAQ' THEN '자주묻는질문'
			     WHEN B.BOARD_TYPE='INQUIRY' THEN '1:1문의'
			END BOARD_TYPE_LABEL,
			B.TITLE,
			B.CONTENTS,
			TO_CHAR(B.REG_DATE,'YYYY-MM-DD') AS REG_DATE_YMD
		FROM FREE_BOARD B
		<where>
			<!-- 키워드 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData)">
				<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(searchData.keyword)">
					AND (B.TITLE LIKE CONCAT('%', #{searchData.keyword}, '%') OR B.CONTENTS LIKE CONCAT('%', #{searchData.keyword}, '%'))
				</if>
			</if>
			<!-- 게시판 종류 배열 검색 -->
			<if test="@org.apache.commons.lang3.ObjectUtils@isNotEmpty(boardTypes)">
			AND B.BOARD_TYPE IN (
				<foreach collection="boardTypes" item="value" separator=",">
				#{value}
				</foreach>
			)
			</if>
			
		</where>
		ORDER BY B.REG_DATE DESC
	</select>
	
	<select id="get" parameterType="Long" resultType="egovframework.com.domain.board.domain.FreeBoard">
		SELECT 
			B.BOARD_SEQ,
			B.BOARD_TYPE,
			B.TITLE,
			B.CONTENTS,
			B.REG_DATE,
			TO_CHAR(B.REG_DATE,'YYYY-MM-DD') AS REG_DATE_YMD
		FROM FREE_BOARD B
		WHERE B.BOARD_SEQ = #{boardSeq}
	</select>
	
	<insert id="insert" parameterType="egovframework.com.domain.board.parameter.FreeBoardParameter" useGeneratedKeys="true" keyProperty="boardSeq">
		INSERT INTO FREE_BOARD
		(
			BOARD_TYPE,
			TITLE,
			CONTENTS,
			REG_DATE
		)
		VALUES
		(
			#{boardType.code},
			#{title},
			#{contents},
			NOW()
		)
		
	</insert>
	
	<update id="update" parameterType="egovframework.com.domain.board.domain.FreeBoard">
		UPDATE FREE_BOARD
		SET
			BOARD_TYPE = #{boardType.code},
			TITLE = #{title},
			CONTENTS = #{contents}
		WHERE BOARD_SEQ = #{boardSeq}
	</update>
	
	<delete id="delete" parameterType="Long">
		DELETE FROM FREE_BOARD
		WHERE BOARD_SEQ = #{boardSeq}
	</delete>
	
	<delete id="deleteArr" parameterType="List">
		DELETE FROM FREE_BOARD
		WHERE BOARD_SEQ in
		<foreach collection="list" item="boardSeq" open="(" close=")" separator=",">
			#{boardSeq} 
		</foreach>
	</delete>
	
</mapper>